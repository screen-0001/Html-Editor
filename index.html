<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>محرر أكواد HTML</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg: #1e1e2f;
      --editor-bg: #282c34;
      --text: #ffffff;
      --label: #61dafb;
      --border: #3a3a4a;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    header {
      text-align: center;
      background: #12121c;
      padding: 15px;
      font-size: 22px;
      font-weight: bold;
      color: #61dafb;
      box-shadow: 0 2px 5px #0005;
    }

    .buttons {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: #12121c;
      box-shadow: 0 2px 5px #0005;
    }

    .buttons input[type="text"] {
      padding: 8px;
      border-radius: 6px;
      border: none;
      width: 200px;
      outline: none;
      font-size: 14px;
    }

    .buttons button {
      background-color: #61dafb;
      color: #000;
      border: none;
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
    }

    .buttons button:hover {
      background-color: #4fc3f7;
    }

    .editor-container {
      display: flex;
      flex: 1;
      overflow: auto;
      padding: 10px;
      gap: 10px;
      flex-wrap: wrap;
    }

    .block {
      flex: 1;
      min-width: 300px;
      display: flex;
      flex-direction: column;
      background: var(--editor-bg);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 8px #0005;
    }

    label {
      background: #202030;
      color: var(--label);
      padding: 10px;
      font-size: 15px;
      border-bottom: 1px solid var(--border);
    }

    textarea {
      flex: 1;
      padding: 10px;
      background: transparent;
      color: var(--text);
      border: none;
      resize: none;
      font-family: monospace;
      font-size: 14px;
      outline: none;
    }

    .preview-container {
      height: 50vh;
      background: white;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    @media (max-width: 768px) {
      .editor-container {
        flex-direction: column;
      }
      .block {
        min-width: 100%;
      }
    }
  </style>
</head>
<body>

  <header>🔧 محرر أكواد HTML + CSS + JS</header>

  <div class="buttons">
    <input type="text" id="projectName" placeholder="اسم المشروع...">
    <button onclick="saveAsFile()">💾 حفظ الكود</button>
    <button onclick="clearEditors()">🧹 تنظيف الكود</button>
<button onclick="openProject()">📂 فتح مشروع</button>
<input type="file" id="fileInput" accept=".html" style="display: none;">
  </div>

  <div class="editor-container">
    <div class="block">
      <label>HTML</label>
      <textarea id="htmlCode"></textarea>
    </div>
    <div class="block">
      <label>CSS</label>
      <textarea id="cssCode"></textarea>
    </div>
    <div class="block">
      <label>JavaScript</label>
      <textarea id="jsCode"></textarea>
    </div>
  </div>

  <div class="preview-container">
    <iframe id="preview"></iframe>
  </div>

  <script>
    const htmlInput = document.getElementById('htmlCode');
    const cssInput = document.getElementById('cssCode');
    const jsInput = document.getElementById('jsCode');
    const projectInput = document.getElementById('projectName');
    const preview = document.getElementById('preview');

    function updatePreview() {
      const html = htmlInput.value;
      const css = `<style>${cssInput.value}</style>`;
      const js = `<script>${jsInput.value}<\/script>`;
      const finalCode = html.replace('</head>', `${css}</head>`)
                            .replace('</body>', `${js}</body>`);
      preview.srcdoc = finalCode;

      // حفظ في localStorage
      localStorage.setItem('htmlCode', html);
      localStorage.setItem('cssCode', cssInput.value);
      localStorage.setItem('jsCode', jsInput.value);
      localStorage.setItem('projectName', projectInput.value);
    }

    function saveAsFile() {
      const html = htmlInput.value;
      const css = `<style>${cssInput.value}</style>`;
      const js = `<script>${jsInput.value}<\/script>`;
      const finalCode = html.replace('</head>', `${css}</head>`)
                            .replace('</body>', `${js}</body>`);

      const name = projectInput.value.trim() || "index";
      const blob = new Blob([finalCode], { type: 'text/html' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = name + ".html";
      link.click();
    }

    function clearEditors() {
      if (confirm("هل تريد مسح المشروع بالكامل؟")) {
        htmlInput.value = "";
        cssInput.value = "";
        jsInput.value = "";
        projectInput.value = "";
        localStorage.clear();
        updatePreview();
      }
    }

    function loadFromStorage() {
      htmlInput.value = localStorage.getItem('htmlCode') || "<!DOCTYPE html>\n<html>\n<head>\n  <title>مشروعي</title>\n</head>\n<body>\n  <h1>مرحبًا</h1>\n</body>\n</html>";
      cssInput.value = localStorage.getItem('cssCode') || "body { font-family: sans-serif; text-align: center; background: #f0f0f0; }";
      jsInput.value = localStorage.getItem('jsCode') || "console.log('مرحبا من جافاسكربت');";
      projectInput.value = localStorage.getItem('projectName') || "";
    }

    // تحميل القيم المخزنة
    loadFromStorage();
    updatePreview();

    htmlInput.addEventListener('input', updatePreview);
    cssInput.addEventListener('input', updatePreview);
    jsInput.addEventListener('input', updatePreview);
    projectInput.addEventListener('input', updatePreview);

function openProject() {
  document.getElementById('fileInput').click();
}

document.getElementById('fileInput').addEventListener('change', function () {
  const file = this.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      const content = e.target.result;

      // استخلاص HTML بدون style وscript
      const temp = document.createElement('html');
      temp.innerHTML = content;

      const style = temp.querySelector('style');
      const script = temp.querySelector('script');

      const htmlOnly = content
        .replace(style?.outerHTML || '', '')
        .replace(script?.outerHTML || '', '');

      htmlInput.value = htmlOnly.trim();
      cssInput.value = style?.innerHTML || '';
      jsInput.value = script?.innerHTML || '';

      projectInput.value = file.name.replace('.html', '');
      updatePreview();
    };
    reader.readAsText(file);
  }
});

  </script>

</body>
</html>
